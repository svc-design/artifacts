build-image-job:
  stage: build
  script:
    - mkdir -p /kaniko/.docker
    - echo "{\"auths\":{"${repository}":{\"auth\":\"$(printf "%s:%s" "${user}" "${password}" | base64 | tr -d '\n')\"}}}" > /kaniko/.docker/config.json
    - /kaniko/executor --context "${CI_PROJECT_DIR}" --dockerfile "${CI_PROJECT_DIR}/${dockerfile}" --destination "${repository}/${image}:${tag}"
  tags:
    - shared
    - shell
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
